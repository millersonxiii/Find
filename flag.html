<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Угадай Флаг - Викторина</title>
  <style>
    :root {
      --bg-primary: #0a0e17;
      --bg-secondary: #131a2a;
      --bg-card: #1a2235;
      --bg-modal: rgba(10, 14, 23, 0.98);
      --accent-gold: #ffd700;
      --accent-silver: #c0c0c0;
      --accent-bronze: #cd7f32;
      --text-primary: #ffffff;
      --text-secondary: #a0aec0;
      --text-muted: #718096;
      --border-color: rgba(255, 255, 255, 0.15);
      --shadow-dark: 0 8px 32px rgba(0, 0, 0, 0.6);
      --shadow-light: 0 4px 16px rgba(255, 255, 255, 0.1);
      
      --rarity-common: #84c78a;
      --rarity-rare: #84b8ff;
      --rarity-epic: #c89cff;
      --rarity-legend: #ffd37a;
      --rarity-mythic: #ff7a7a;
      --rarity-secret: #9ea0a6;
      
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      height: 100%;
      overflow: hidden;
      font-family: 'Inter', 'Segoe UI', system-ui, Roboto, Arial, sans-serif;
      color: var(--text-primary);
      background: var(--bg-primary);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      -webkit-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    #app {
      height: 100vh;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      z-index: 100;
    }

    .nav-btn {
      width: 50px;
      height: 50px;
      background: transparent;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .nav-btn:hover {
      transform: translateY(-2px);
    }

    .nav-btn img {
      width: 40px;
      height: 40px;
      transition: transform 0.3s ease;
    }

    .nav-btn:hover img {
      transform: scale(1.1);
    }

    .logo {
      text-align: center;
    }

    .logo h1 {
      font-size: 20px;
      font-weight: 800;
      color: var(--text-primary);
      margin-bottom: 2px;
    }

    .developer {
      font-size: 12px;
      color: var(--text-muted);
      font-weight: 500;
    }

    .stats-container {
      display: flex;
      gap: 15px;
      align-items: center;
      padding: 10px 16px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
    }

    .stat {
      background: var(--bg-card);
      padding: 8px 12px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-color);
      text-align: center;
      min-width: 80px;
    }

    .stat-value {
      font-size: 18px;
      font-weight: 800;
      color: var(--accent-gold);
    }

    .stat-label {
      font-size: 12px;
      color: var(--text-muted);
    }

    .game-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      gap: 30px;
    }

 
    .flag-image {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
    }

    .answers-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      max-width: 500px;
      width: 100%;
    }

    .answer-btn {
      padding: 16px;
      background: var(--bg-secondary);
      border: 2px solid var(--border-color);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-align: center;
    }

    .answer-btn:hover {
      background: var(--bg-card);
      transform: translateY(-2px);
      border-color: var(--accent-gold);
    }

    .answer-btn.correct {
      background: #2d5016;
      border-color: #4ade80;
    }

    .answer-btn.incorrect {
      background: #5c1a1a;
      border-color: #f87171;
    }

    .restart-btn {
      padding: 16px 32px;
      font-size: 18px;
      font-weight: 800;
      background: linear-gradient(135deg, var(--accent-gold), var(--accent-bronze));
      border: none;
      border-radius: var(--radius-md);
      color: #000;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
      box-shadow: var(--shadow-dark);
    }

    .restart-btn:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 25px rgba(255, 215, 0, 0.4);
    }

    .inventory {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-modal);
      z-index: 1000;
      padding: 20px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .inv-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border-color);
    }

    .inv-header h2 {
      font-size: 24px;
      font-weight: 800;
      color: var(--text-primary);
    }

    .inv-controls {
      display: flex;
      gap: 16px;
      align-items: center;
    }

    .filter-btn {
      padding: 8px 16px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.2s ease;
      margin-right: 8px;
    }

    .filter-btn:hover {
      background: var(--bg-primary);
    }

    .close-btn {
      width: 32px;
      height: 32px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: 50%;
      color: var(--text-primary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      transition: all 0.2s ease;
    }

    .close-btn:hover {
      background: var(--accent-gold);
      color: #000;
      transform: rotate(90deg);
    }

    .cards-grid {
      flex: 1;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 16px;
      overflow-y: auto;
      padding: 8px;
    }

    .card {
      background: var(--bg-card);
      border-radius: var(--radius-md);
      padding: 12px;
      border: 1px solid var(--border-color);
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      min-height: 200px;
      display: flex;
      flex-direction: column;
    }

    .card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-dark);
    }

    .card img {
      width: 100%;
      height: 120px;
      object-fit: cover;
      border-radius: var(--radius-sm);
      margin-bottom: 8px;
      background: var(--bg-secondary);
    }

    .card-name {
      font-weight: 700;
      font-size: 14px;
      margin-bottom: 4px;
      text-align: center;
    }
    
    .main-menu-btn {
      padding: 10px 16px;
      background: var(--bg-card);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 14px;
      font-weight: 600;
      text-decoration: none;
    }
    
    .card-meta {
      font-size: 12px;
      color: var(--text-secondary);
      text-align: center;
      margin-bottom: 8px;
    }

    .rarity-strip {
      height: 6px;
      border-radius: 3px;
      margin-top: auto;
    }

    .rarity-Обычные { background: var(--rarity-common); }
    .rarity-Редкие { background: var(--rarity-rare); }
    .rarity-Эпические { background: var(--rarity-epic); }
    .rarity-Легендарные { background: var(--rarity-legend); }
    .rarity-Мифические { background: var(--rarity-mythic); }
    .rarity-Секретные { background: var(--rarity-secret); }

    .inv-footer {
      padding: 16px 0;
      border-top: 1px solid var(--border-color);
      margin-top: 16px;
    }

    .inv-count {
      text-align: center;
      color: var(--text-secondary);
      font-size: 14px;
    }

    .card-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--bg-modal);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      overflow: hidden;
    }

    .card-modal-content {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 24px;
      max-width: 500px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      box-shadow: var(--shadow-dark);
      overflow-x: hidden;
    }

    .card-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      align-items: start;
    }

    .card-image img {
      width: 100%;
      height: auto;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-dark);
    }

    .card-info h3 {
      font-size: 24px;
      font-weight: 800;
      margin-bottom: 12px;
      color: var(--text-primary);
    }

    .rarity-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      margin-top: 8px;
    }

    .card-description {
      font-size: 14px;
      line-height: 1.6;
      color: var(--text-secondary);
    }

    .hidden {
      display: none !important;
    }

    audio {
      position: absolute;
      left: -9999px;
      opacity: 0;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
    }

    @media (max-width: 768px) {
      .flag-container {
        padding: 20px;
        max-width: 300px;
      }
      
      .answers-container {
        grid-template-columns: 1fr;
        max-width: 300px;
      }
      
      .stats-container {
        gap: 10px;
      }
      
      .stat {
        min-width: 70px;
        padding: 6px 10px;
      }
      
      .stat-value {
        font-size: 16px;
      }
      
      .cards-grid {
        grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
      }
    }

    @media (max-width: 480px) {
      .topbar {
        padding: 8px 12px;
      }
      
      .logo h1 {
        font-size: 18px;
      }
      
      .flag-container {
        padding: 15px;
        max-width: 250px;
      }
      
      .answer-btn {
        padding: 14px;
        font-size: 14px;
      }
      
      .card-details {
        grid-template-columns: 1fr;
        gap: 16px;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <header class="topbar">
      <a href="inventory.html" class="nav-btn">
        <img src="images/inv.png" alt="Инвентарь" />
      </a>
      
      <a href="menu.html" class="main-menu-btn">Главное меню</a>
      
      <button class="nav-btn" id="settingsBtn">
        <img src="images/setting.png" alt="Настройки" />
      </button>
    </header>

    <div class="stats-container">
      <div class="stat">
        <div class="stat-value" id="currentScore">0</div>
        <div class="stat-label">Текущая серия</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="bestScore">0</div>
        <div class="stat-label">Рекорд</div>
      </div>
    </div>

    <main class="game-container">
      <div class="flag-container">
        <img id="flagImage" class="flag-image" src="" alt="Угадай флаг" />
      </div>
      
      <div class="answers-container" id="answersContainer">
      </div>
      
      <button class="restart-btn hidden" id="restartBtn">Сначала</button>
    </main>

    <div id="inventory" class="inventory hidden">
      <div class="inv-header">
        <h2>Коллекция политиков</h2>
        <div class="inv-controls">
          <button class="close-btn" id="closeInventory">✕</button>
        </div>
      </div>
      <div class="cards-grid" id="cardsGrid">
      </div>
      <div class="inv-footer">
        <div class="inv-count" id="invCount">Карт: 0/0</div>
      </div>
    </div>

    <div id="card-modal" class="card-modal hidden">
      <div class="card-modal-content">
        <button class="close-btn" id="closeCardModal">✕</button>
        <div id="cardModalContent"></div>
      </div>
    </div>

    <audio id="correct-sound" src="sound/yes.mp3" preload="auto"></audio>
    <audio id="incorrect-sound" src="sound/no.mp3" preload="auto"></audio>
    <audio id="click-sound" src="sound/clicking.mp3" preload="auto"></audio>
    <audio id="bg-music" src="music/fon1.mp3" loop preload="auto"></audio>
  </div>

  <script>
    (() => {
      const FLAGS = [
        { country: "Россия", file: "russia.png" },
        { country: "США", file: "united_states.png" },
        { country: "Германия", file: "germany.png" },
        { country: "Франция", file: "france.png" },
        { country: "Великобритания", file: "united_kingdom.png" },
        { country: "Италия", file: "italy.png" },
        { country: "Испания", file: "spain.png" },
        { country: "Украина", file: "ukraine.png" },
        { country: "Польша", file: "poland.png" },
        { country: "Китай", file: "china.png" },
        { country: "Япония", file: "japan.png" },
        { country: "Канада", file: "canada.png" },
        { country: "Бразилия", file: "brazil.png" },
        { country: "Австралия", file: "australia.png" },
        { country: "Индия", file: "india.png" },
        { country: "Турция", file: "turkey.png" },
        { country: "Нидерланды", file: "netherlands.png" },
        { country: "Швеция", file: "sweden.png" },
        { country: "Швейцария", file: "switzerland.png" },
        { country: "Австрия", file: "austria.png" },
        { country: "Бельгия", file: "belgium.png" },
        { country: "Норвегия", file: "norway.png" },
        { country: "Дания", file: "denmark.png" },
        { country: "Финляндия", file: "finland.png" },
        { country: "Португалия", file: "portugal.png" },
        { country: "Греция", file: "greece.png" },
        { country: "Чехия", file: "czech_republic.png" },
        { country: "Румыния", file: "romania.png" },
        { country: "Венгрия", file: "hungary.png" },
        { country: "Болгария", file: "bulgaria.png" },
        { country: "Словакия", file: "slovakia.png" },
        { country: "Хорватия", file: "croatia.png" },
        { country: "Ирландия", file: "ireland.png" },
        { country: "Сербия", file: "serbia.png" },
        { country: "Литва", file: "lithuania.png" },
        { country: "Латвия", file: "latvia.png" },
        { country: "Эстония", file: "estonia.png" },
        { country: "Словения", file: "slovenia.png" },
        { country: "Кипр", file: "cyprus.png" },
        { country: "Мальта", file: "malta.png" },
        { country: "Исландия", file: "iceland.png" },
        { country: "Люксембург", file: "luxembourg.png" },
        { country: "Черногория", file: "montenegro.png" },
        { country: "Албания", file: "albania.png" },
        { country: "Северная Македония", file: "north_macedonia.png" },
        { country: "Босния и Герцеговина", file: "bosnia_herzegovina.png" },
        { country: "Молдова", file: "moldova.png" },
        { country: "Беларусь", file: "belarus.png" },
        { country: "Армения", file: "armenia.png" },
        { country: "Грузия", file: "georgia.png" },
        { country: "Азербайджан", file: "azerbaijan.png" },
        { country: "Казахстан", file: "kazakhstan.png" },
        { country: "Узбекистан", file: "uzbekistan.png" },
        { country: "Израиль", file: "israel.png" },
        { country: "Саудовская Аравия", file: "saudi_arabia.png" },
        { country: "ОАЭ", file: "united_arab_emirates.png" },
        { country: "Катар", file: "qatar.png" },
        { country: "Южная Корея", file: "south_korea.png" },
        { country: "Таиланд", file: "thailand.png" },
        { country: "Малайзия", file: "malaysia.png" },
        { country: "Сингапур", file: "singapore.png" },
        { country: "Вьетнам", file: "vietnam.png" },
        { country: "Индонезия", file: "indonesia.png" },
        { country: "Филиппины", file: "philippines.png" },
        { country: "Мексика", file: "mexico.png" },
        { country: "Аргентина", file: "argentina.png" },
        { country: "Чили", file: "chile.png" },
        { country: "Колумбия", file: "colombia.png" },
        { country: "Перу", file: "peru.png" },
        { country: "Венесуэла", file: "venezuela.png" },
        { country: "Египет", file: "egypt.png" },
        { country: "ЮАР", file: "south_africa.png" },
        { country: "Нигерия", file: "nigeria.png" },
        { country: "Кения", file: "kenya.png" },
        { country: "Марокко", file: "morocco.png" },
        { country: "Тунис", file: "tunisia.png" },
        { country: "Алжир", file: "algeria.png" },
        { country: "Ангола", file: "angola.png" },
        { country: "Гана", file: "ghana.png" },
        { country: "Эфиопия", file: "ethiopia.png" },
        { country: "Танзания", file: "tanzania.png" },
        { country: "Куба", file: "cuba.png" },
        { country: "Доминиканская Республика", file: "dominican_republic.png" },
        { country: "Ямайка", file: "jamaica.png" },
        { country: "Гаити", file: "haiti.png" },
        { country: "Панама", file: "panama.png" },
        { country: "Коста-Рика", file: "costa_rica.png" },
        { country: "Гватемала", file: "guatemala.png" },
        { country: "Сальвадор", file: "el_salvador.png" },
        { country: "Гондурас", file: "honduras.png" },
        { country: "Никарагуа", file: "nicaragua.png" },
        { country: "Парагвай", file: "paraguay.png" },
        { country: "Уругвай", file: "uruguay.png" },
        { country: "Эквадор", file: "ecuador.png" },
        { country: "Боливия", file: "bolivia.png" },
        { country: "Новая Зеландия", file: "new_zealand.png" },
        { country: "Фиджи", file: "fiji.png" },
        { country: "Папуа — Новая Гвинея", file: "papua_new_guinea.png" },
        { country: "Вануату", file: "vanuatu.png" },
        { country: "Самоа", file: "samoa.png" },
        { country: "Иран", file: "iran.png" },
        { country: "Ирак", file: "iraq.png" },
        { country: "Афганистан", file: "afghanistan.png" },
        { country: "Пакистан", file: "pakistan.png" },
        { country: "Бангладеш", file: "bangladesh.png" },
        { country: "Шри-Ланка", file: "sri_lanka.png" },
        { country: "Непал", file: "nepal.png" },
        { country: "Бутан", file: "bhutan.png" },
        { country: "Мьянма", file: "myanmar.png" },
        { country: "Камбоджа", file: "cambodia.png" },
        { country: "Лаос", file: "laos.png" },
        { country: "Монголия", file: "mongolia.png" },
        { country: "Северная Корея", file: "north_korea.png" },
        { country: "Йемен", file: "yemen.png" },
        { country: "Оман", file: "oman.png" },
        { country: "Кувейт", file: "kuwait.png" },
        { country: "Бахрейн", file: "bahrain.png" },
        { country: "Иордания", file: "jordan.png" },
        { country: "Ливан", file: "lebanon.png" },
        { country: "Сирия", file: "syria.png" },
        { country: "Палестина", file: "palestine.png" },
        { country: "Ливия", file: "libya.png" },
        { country: "Судан", file: "sudan.png" },
        { country: "Южный Судан", file: "south_sudan.png" },
        { country: "Чад", file: "chad.png" },
        { country: "Нигер", file: "niger.png" },
        { country: "Мали", file: "mali.png" },
        { country: "Буркина-Фасо", file: "burkina_faso.png" },
        { country: "Сенегал", file: "senegal.png" },
        { country: "Гвинея", file: "guinea.png" },
        { country: "Сьерра-Леоне", file: "sierra_leone.png" },
        { country: "Либерия", file: "liberia.png" },
        { country: "Кот-д'Ивуар", file: "cote_divoire.png" },
        { country: "Гана", file: "ghana.png" },
        { country: "Того", file: "togo.png" },
        { country: "Бенин", file: "benin.png" },
        { country: "Камерун", file: "cameroon.png" },
        { country: "ЦАР", file: "central_african_republic.png" },
        { country: "ДР Конго", file: "democratic_republic_of_congo.png" },
        { country: "Конго", file: "republic_of_congo.png" },
        { country: "Уганда", file: "uganda.png" },
        { country: "Руанда", file: "rwanda.png" },
        { country: "Бурунди", file: "burundi.png" },
        { country: "Кения", file: "kenya.png" },
        { country: "Эфиопия", file: "ethiopia.png" },
        { country: "Сомали", file: "somalia.png" },
        { country: "Джибути", file: "djibouti.png" },
        { country: "Эритрея", file: "eritrea.png" },
        { country: "Замбия", file: "zambia.png" },
        { country: "Зимбабве", file: "zimbabwe.png" },
        { country: "Мозамбик", file: "mozambique.png" },
        { country: "Мадагаскар", file: "madagascar.png" },
        { country: "Маврикий", file: "mauritius.png" },
        { country: "Сейшелы", file: "seychelles.png" },
        { country: "Коморы", file: "comoros.png" },
        { country: "Белиз", file: "belize.png" },
        { country: "Багамы", file: "bahamas.png" },
        { country: "Барбадос", file: "barbados.png" },
        { country: "Тринидад и Тобаго", file: "trinidad_tobago.png" },
        { country: "Гренада", file: "grenada.png" },
        { country: "Сент-Люсия", file: "saint_lucia.png" },
        { country: "Сент-Винсент и Гренадины", file: "saint_vincent_grenadines.png" },
        { country: "Антигуа и Барбуда", file: "antigua_barbuda.png" },
        { country: "Сент-Китс и Невис", file: "saint_kitts_nevis.png" },
        { country: "Доминика", file: "dominica.png" },
        { country: "Суринам", file: "suriname.png" },
        { country: "Гайана", file: "guyana.png" },
        { country: "Андорра", file: "andorra.png" },
        { country: "Лихтенштейн", file: "liechtenstein.png" },
        { country: "Монако", file: "monaco.png" },
        { country: "Сан-Марино", file: "san_marino.png" },
        { country: "Ватикан", file: "vatican_city.png" },
        { country: "Мальдивы", file: "maldives.png" },
        { country: "Бруней", file: "brunei.png" },
        { country: "Восточный Тимор", file: "east_timor.png" },
        { country: "Кирибати", file: "kiribati.png" },
        { country: "Маршалловы Острова", file: "marshall_islands.png" },
        { country: "Микронезия", file: "micronesia.png" },
        { country: "Науру", file: "nauru.png" },
        { country: "Палау", file: "palau.png" },
        { country: "Соломоновы Острова", file: "solomon_islands.png" },
        { country: "Тонга", file: "tonga.png" },
        { country: "Тувалу", file: "tuvalu.png" },
        { country: "Кабо-Верде", file: "cape_verde.png" },
        { country: "Сан-Томе и Принсипи", file: "sao_tome_and_principe.png" },
        { country: "Гвинея-Бисау", file: "guinea_bissau.png" },
        { country: "Экваториальная Гвинея", file: "equatorial_guinea.png" },
        { country: "Габон", file: "gabon.png" },
        { country: "Ботсвана", file: "botswana.png" },
        { country: "Намибия", file: "namibia.png" },
        { country: "Лесото", file: "lesotho.png" },
        { country: "Эсватини", file: "eswatini.png" },
        { country: "Мавритания", file: "mauritania.png" },
        { country: "Западная Сахара", file: "western_sahara.png" },
        { country: "Гамбия", file: "gambia.png" },
        { country: "Кыргызстан", file: "kyrgyzstan.png" },
        { country: "Таджикистан", file: "tajikistan.png" },
        { country: "Туркменистан", file: "turkmenistan.png" }
      ];

      const POLITICIANS = [
        {
          "name":"Ханс-Адам II",
          "title":"Князь",
          "country":"Лихтенштейн",
          "rarity":"Обычные",
          "image":"images/cart/hans_adam.png",
          "description":"Правящий князь Лихтенштейна с 1989 года."
        },
        {
          "name":"Даниэль Риш",
          "title":"Премьер-министр",
          "country":"Лихтенштейн",
          "rarity":"Обычные",
          "image":"images/cart/daniel_rish.png",
          "description":"Глава правительства Лихтенштейна с 2021 года."
        },
        {
          "name":"Гвюдни Йоуханнессон",
          "title":"Президент",
          "country":"Исландия",
          "rarity":"Обычные",
          "image":"images/cart/gudni_johannesson.png",
          "description":"Президент Исландии с 2016 года."
        },
        {
          "name":"Катрин Якобсдоуттир",
          "title":"Премьер-министр",
          "country":"Исландия",
          "rarity":"Обычные",
          "image":"images/cart/katrin_jakobsdottir.png",
          "description":"Премьер-министр Исландии с 2017 года."
        },
        {
          "name":"Джордж Велла",
          "title":"Президент",
          "country":"Мальта",
          "rarity":"Обычные",
          "image":"images/cart/george_vella.png",
          "description":"Президент Мальты с 2019 года."
        },
        {
          "name":"Роберт Абела",
          "title":"Премьер-министр",
          "country":"Мальта",
          "rarity":"Обычные",
          "image":"images/cart/robert_abela.png",
          "description":"Премьер-министр Мальты с 2020 года."
        },
        {
          "name":"Альбер II",
          "title":"Князь",
          "country":"Монако",
          "rarity":"Обычные",
          "image":"images/cart/albert_ii.png",
          "description":"Правящий князь Монако с 2005 года."
        },
        {
          "name":"Пьер Дарту",
          "title":"Государственный министр",
          "country":"Монако",
          "rarity":"Обычные",
          "image":"images/cart/pierre_dartout.png",
          "description":"Государственный министр Монако с 2020 года."
        },
        {
          "name":"Александр Ван дер Беллен",
          "title":"Президент",
          "country":"Австрия",
          "rarity":"Обычные",
          "image":"images/cart/alexander_van_der_bellen.png",
          "description":"Федеральный президент Австрии с 2017 года."
        },
        {
          "name":"Карл Нехаммер",
          "title":"Канцлер",
          "country":"Австрия",
          "rarity":"Обычные",
          "image":"images/cart/karl_nehammer.png",
          "description":"Федеральный канцлер Австрии с 2021 года."
        },
        {
          "name":"Байрам Бегай",
          "title":"Президент",
          "country":"Албания",
          "rarity":"Обычные",
          "image":"images/cart/bajram_begaj.png",
          "description":"Президент Албании с 2022 года."
        },
        {
          "name":"Эди Рама",
          "title":"Премьер-министр",
          "country":"Албания",
          "rarity":"Обычные",
          "image":"images/cart/edi_rama.png",
          "description":"Премьер-министр Албании с 2013 года."
        },
        {
          "name":"Румен Радев",
          "title":"Президент",
          "country":"Болгария",
          "rarity":"Обычные",
          "image":"images/cart/rumen_radev.png",
          "description":"Президент Болгарии с 2017 года."
        },
        {
          "name":"Димитр Главчев",
          "title":"Премьер-министр",
          "country":"Болгария",
          "rarity":"Обычные",
          "image":"images/cart/dimitar_glavchev.png",
          "description":"Премьер-министр Болгарии с 2024 года."
        },
        {
          "name":"Катерина Сакелларопулу",
          "title":"Президент",
          "country":"Греция",
          "rarity":"Обычные",
          "image":"images/cart/katerina_sakellaropoulou.png",
          "description":"Президент Греции с 2020 года."
        },
        {
          "name":"Кириакос Мицотакис",
          "title":"Премьер-министр",
          "country":"Греция",
          "rarity":"Обычные",
          "image":"images/cart/kyriakos_mitsotakis.png",
          "description":"Премьер-министр Греции с 2023 года."
        },
        {
          "name":"Зузана Чапутова",
          "title":"Президент",
          "country":"Словакия",
          "rarity":"Обычные",
          "image":"images/cart/zuzana_caputova.png",
          "description":"Президент Словакии с 2019 года."
        },
        {
          "name":"Роберт Фицо",
          "title":"Премьер-министр",
          "country":"Словакия",
          "rarity":"Обычные",
          "image":"images/cart/robert_fico.png",
          "description":"Премьер-министр Словакии с 2023 года."
        },
        {
          "name":"Наташа Пирц Мусар",
          "title":"Президент",
          "country":"Словения",
          "rarity":"Обычные",
          "image":"images/cart/natasa_pirc_musar.png",
          "description":"Президент Словении с 2022 года."
        },
        {
          "name":"Роберт Голоб",
          "title":"Премьер-министр",
          "country":"Словения",
          "rarity":"Обычные",
          "image":"images/cart/robert_golob.png",
          "description":"Премьер-министр Словении с 2022 года."
        },
        {
          "name":"Клаус Йоханнис",
          "title":"Президент",
          "country":"Румыния",
          "rarity":"Обычные",
          "image":"images/cart/klaus_iohannis.png",
          "description":"Президент Румынии с 2014 года."
        },
        {
          "name":"Марчел Чолаку",
          "title":"Премьер-министр",
          "country":"Румыния",
          "rarity":"Обычные",
          "image":"images/cart/marcel_ciolacu.png",
          "description":"Премьер-министр Румынии с 2023 года."
        },
        {
          "name":"Эдгарс Ринкевичс",
          "title":"Президент",
          "country":"Латвия",
          "rarity":"Обычные",
          "image":"images/cart/edgars_rinkevics.png",
          "description":"Президент Латвии с 2023 года."
        },
        {
          "name":"Эвика Силиня",
          "title":"Премьер-министр",
          "country":"Латвия",
          "rarity":"Обычные",
          "image":"images/cart/evika_silina.png",
          "description":"Премьер-министр Латвии с 2023 года."
        },
        {
          "name":"Гитанас Науседа",
          "title":"Президент",
          "country":"Литва",
          "rarity":"Обычные",
          "image":"images/cart/gitanas_nauseda.png",
          "description":"Президент Литвы с 2019 года."
        },
        {
          "name":"Ингрида Шимоните",
          "title":"Премьер-министр",
          "country":"Литва",
          "rarity":"Обычные",
          "image":"images/cart/ingrida_simonyte.png",
          "description":"Премьер-министр Литвы с 2020 года."
        },
        {
          "name":"Алар Карис",
          "title":"Президент",
          "country":"Эстония",
          "rarity":"Обычные",
          "image":"images/cart/alar_karis.png",
          "description":"Президент Эстонии с 2021 года."
        },
        {
          "name":"Кая Каллас",
          "title":"Премьер-министр",
          "country":"Эстония",
          "rarity":"Обычные",
          "image":"images/cart/kaja_kallas.png",
          "description":"Премьер-министр Эстонии с 2021 года."
        },
        {
          "name":"Майкл Д. Хиггинс",
          "title":"Президент",
          "country":"Ирландия",
          "rarity":"Обычные",
          "image":"images/cart/michael_higgins.png",
          "description":"Президент Ирландии с 2011 года."
        },
        {
          "name":"Лео Варадкар",
          "title":"Тайшич",
          "country":"Ирландия",
          "rarity":"Обычные",
          "image":"images/cart/leo_varadkar.png",
          "description":"Премьер-министр Ирландии."
        },
        {
          "name":"Саули Нийнистё",
          "title":"Президент",
          "country":"Финляндия",
          "rarity":"Редкие",
          "image":"images/cart/sauli_niinisto.png",
          "description":"Президент Финляндии с 2012 года."
        },
        {
          "name":"Петтери Орпо",
          "title":"Премьер-министр",
          "country":"Финляндия",
          "rarity":"Редкие",
          "image":"images/cart/petteri_orpo.png",
          "description":"Премьер-министр Финляндии с 2023 года."
        },
        {
          "name":"Владимир Зеленский",
          "title":"Президент",
          "country":"Украина",
          "rarity":"Редкие",
          "image":"images/cart/volodymyr_zelensky.png",
          "description":"Президент Украины с 2019 года."
        },
        {
          "name":"Денис Шмыгаль",
          "title":"Премьер-министр",
          "country":"Украина",
          "rarity":"Редкие",
          "image":"images/cart/denys_shmyhal.png",
          "description":"Премьер-министр Украины с 2020 года."
        },
        {
          "name":"Фелипе VI",
          "title":"Король",
          "country":"Испания",
          "rarity":"Редкие",
          "image":"images/cart/felipe_vi.png",
          "description":"Король Испании с 2014 года."
        },
        {
          "name":"Педро Санчес",
          "title":"Премьер-министр",
          "country":"Испания",
          "rarity":"Редкие",
          "image":"images/cart/pedro_sanchez.png",
          "description":"Премьер-министр Испании с 2018 года."
        },
        {
          "name":"Виллем-Александр",
          "title":"Король",
          "country":"Нидерланды",
          "rarity":"Редкие",
          "image":"images/cart/willem_alexander.png",
          "description":"Король Нидерландов с 2013 года."
        },
        {
          "name":"Марк Рютте",
          "title":"Премьер-министр",
          "country":"Нидерланды",
          "rarity":"Редкие",
          "image":"images/cart/mark_rutte.png",
          "description":"Премьер-министр Нидерландов с 2010 года."
        },
        {
          "name":"Маргрете II",
          "title":"Королева",
          "country":"Дания",
          "rarity":"Редкие",
          "image":"images/cart/margrethe_ii.png",
          "description":"Королева Дании с 1972 года."
        },
        {
          "name":"Метте Фредериксен",
          "title":"Премьер-министр",
          "country":"Дания",
          "rarity":"Редкие",
          "image":"images/cart/mette_frederiksen.png",
          "description":"Премьер-министр Дании с 2019 года."
        },
        {
          "name":"Карл XVI Густав",
          "title":"Король",
          "country":"Швеция",
          "rarity":"Редкие",
          "image":"images/cart/carl_xvi_gustaf.png",
          "description":"Король Швеции с 1973 года."
        },
        {
          "name":"Ульф Кристерссон",
          "title":"Премьер-министр",
          "country":"Швеция",
          "rarity":"Редкие",
          "image":"images/cart/ulf_kristersson.png",
          "description":"Премьер-министр Швеции с 2022 года."
        },
        {
          "name":"Харальд V",
          "title":"Король",
          "country":"Норвегия",
          "rarity":"Редкие",
          "image":"images/cart/harald_v.png",
          "description":"Король Норвегии с 1991 года."
        },
        {
          "name":"Йонас Гар Стёре",
          "title":"Премьер-министр",
          "country":"Норвегия",
          "rarity":"Редкие",
          "image":"images/cart/jonas_gahr_store.png",
          "description":"Премьер-министр Норвегии с 2021 года."
        },
        {
          "name":"Филипп",
          "title":"Король",
          "country":"Бельгия",
          "rarity":"Редкие",
          "image":"images/cart/philippe.png",
          "description":"Король Бельгии с 2013 года."
        },
        {
          "name":"Александр Де Кроо",
          "title":"Премьер-министр",
          "country":"Бельгия",
          "rarity":"Редкие",
          "image":"images/cart/alexander_de_croo.png",
          "description":"Премьер-министр Бельгии с 2020 года."
        },
        {
          "name":"Анри",
          "title":"Великий герцог",
          "country":"Люксембург",
          "rarity":"Редкие",
          "image":"images/cart/henri.png",
          "description":"Великий герцог Люксембурга с 2000 года."
        },
        {
          "name":"Ксавье Беттель",
          "title":"Премьер-министр",
          "country":"Люксембург",
          "rarity":"Редкие",
          "image":"images/cart/xavier_bettel.png",
          "description":"Премьер-министр Люксембурга с 2013 года."
        },
        {
          "name":"Яков Милатович",
          "title":"Президент",
          "country":"Черногория",
          "rarity":"Редкие",
          "image":"images/cart/jakov_milatovic.png",
          "description":"Президент Черногории с 2023 года."
        },
        {
          "name":"Милойко Спаич",
          "title":"Премьер-министр",
          "country":"Черногория",
          "rarity":"Редкие",
          "image":"images/cart/milojko_spajic.png",
          "description":"Премьер-министр Черногории с 2023 года."
        },
        {
          "name":"Карл III",
          "title":"Король",
          "country":"Великобритания",
          "rarity":"Эпические",
          "image":"images/cart/charles_iii.png",
          "description":"Король Великобритании с 2022 года."
        },
        {
          "name":"Кир Стармер",
          "title":"Премьер-министр",
          "country":"Великобритания",
          "rarity":"Эпические",
          "image":"images/cart/keir_starmer.png",
          "description":"Премьер-министр Великобритании с 2024 года."
        },
        {
          "name":"Тамаш Суйок",
          "title":"Президент",
          "country":"Венгрия",
          "rarity":"Эпические",
          "image":"images/cart/tamas_sulyok.png",
          "description":"Президент Венгрии с 2024 года."
        },
        {
          "name":"Виктор Орбан",
          "title":"Премьер-министр",
          "country":"Венгрия",
          "rarity":"Эпические",
          "image":"images/cart/viktor_orban.png",
          "description":"Премьер-министр Венгрии с 2010 года."
        },
        {
          "name":"Франк-Вальтер Штайнмайер",
          "title":"Президент",
          "country":"Германия",
          "rarity":"Эпические",
          "image":"images/cart/frank_walter_steinmeier.png",
          "description":"Федеральный президент Германии с 2017 года."
        },
        {
          "name":"Фридрих Мерц",
          "title":"Канцлер",
          "country":"Германия",
          "rarity":"Эпические",
          "image":"images/cart/friedrich_merz.png",
          "description":"Канцлер Германии."
        },
        {
          "name":"Серджо Маттарелла",
          "title":"Президент",
          "country":"Италия",
          "rarity":"Эпические",
          "image":"images/cart/sergio_mattarella.png",
          "description":"Президент Италии с 2015 года."
        },
        {
          "name":"Джорджа Мелони",
          "title":"Премьер-министр",
          "country":"Италия",
          "rarity":"Эпические",
          "image":"images/cart/giorgia_meloni.png",
          "description":"Премьер-министр Италии с 2022 года."
        },
        {
          "name":"Зоран Миланович",
          "title":"Президент",
          "country":"Хорватия",
          "rarity":"Эпические",
          "image":"images/cart/zoran_milanovic.png",
          "description":"Президент Хорватии с 2020 года."
        },
        {
          "name":"Андрей Пленкович",
          "title":"Премьер-министр",
          "country":"Хорватия",
          "rarity":"Эпические",
          "image":"images/cart/andrej_plenkovic.png",
          "description":"Премьер-министр Хорватии с 2016 года."
        },
        {
          "name":"Марселу Ребелу ди Соза",
          "title":"Президент",
          "country":"Португалия",
          "rarity":"Эпические",
          "image":"images/cart/marcelo_rebelo_de_sousa.png",
          "description":"Президент Португалии с 2016 года."
        },
        {
          "name":"Антониу Кошта",
          "title":"Премьер-министр",
          "country":"Португалия",
          "rarity":"Эпические",
          "image":"images/cart/antonio_costa.png",
          "description":"Премьер-министр Португалии с 2015 года."
        },
        {
          "name":"Майя Санду",
          "title":"Президент",
          "country":"Молдова",
          "rarity":"Эпические",
          "image":"images/cart/maia_sandu.png",
          "description":"Президент Молдовы с 2020 года."
        },
        {
          "name":"Дорин Речан",
          "title":"Премьер-министр",
          "country":"Молдова",
          "rarity":"Эпические",
          "image":"images/cart/dorin_recean.png",
          "description":"Премьер-министр Молдовы с 2023 года."
        },
        {
          "name":"Кароль Навроцкий",
          "title":"Президент",
          "country":"Польша",
          "rarity":"Эпические",
          "image":"images/cart/karol_nawrocki.png",
          "description":"Президент Польши."
        },
        {
          "name":"Дональд Туск",
          "title":"Премьер-министр",
          "country":"Польша",
          "rarity":"Эпические",
          "image":"images/cart/donald_tusk.png",
          "description":"Премьер-министр Польши с 2023 года."
        },
        {
          "name":"Петр Павел",
          "title":"Президент",
          "country":"Чехия",
          "rarity":"Эпические",
          "image":"images/cart/petr_pavel.png",
          "description":"Президент Чехии с 2023 года."
        },
        {
          "name":"Петр Фиала",
          "title":"Премьер-министр",
          "country":"Чехия",
          "rarity":"Эпические",
          "image":"images/cart/petr_fiala.png",
          "description":"Премьер-министр Чехии с 2021 года."
        },
        {
          "name":"Папа Франциск",
          "title":"Папа Римский",
          "country":"Ватикан",
          "rarity":"Легендарные",
          "image":"images/cart/pope_francis.png",
          "description":"266-й Папа Римский с 2013 года."
        },
        {
          "name":"Пьетро Паролин",
          "title":"Государственный секретарь",
          "country":"Ватикан",
          "rarity":"Легендарные",
          "image":"images/cart/pietro_parolin.png",
          "description":"Государственный секретарь Ватикана с 2013 года."
        },
        {
          "name":"Жоан Энрик Вивес-и-Сисилья",
          "title":"Соправитель",
          "country":"Андорра",
          "rarity":"Легендарные",
          "image":"images/cart/joan_enric_vives.png",
          "description":"Соправитель Андорры как Епископ Урхельский."
        },
        {
          "name":"Ксавье Эспот Самора",
          "title":"Премьер-министр",
          "country":"Андорра",
          "rarity":"Легендарные",
          "image":"images/cart/xavier_espot_zamora.png",
          "description":"Глава правительства Андорры с 2019 года."
        },
        {
          "name":"Алессандро Скарано",
          "title":"Капитан-регент",
          "country":"Сан-Марино",
          "rarity":"Легендарные",
          "image":"images/cart/alessandro_scarano.png",
          "description":"Капитан-регент Сан-Марино."
        },
        {
          "name":"Аделе Тоннини",
          "title":"Капитан-регент",
          "country":"Сан-Марино",
          "rarity":"Легендарные",
          "image":"images/cart/adele_tonnini.png",
          "description":"Капитан-регент Сан-Марино."
        },
        {
          "name":"Федеральный совет",
          "title":"Коллегиальное правление",
          "country":"Швейцария",
          "rarity":"Легендарные",
          "image":"images/cart/federal_council.png",
          "description":"Коллективный глава государства Швейцарии."
        },
        {
          "name":"Эмманюэль Макрон",
          "title":"Президент",
          "country":"Франция",
          "rarity":"Легендарные",
          "image":"images/cart/emmanuel_macron.png",
          "description":"Президент Франции с 2017 года. Так же соправитель Андорры"
        },
        {
          "name":"Габриэль Атталь",
          "title":"Премьер-министр",
          "country":"Франция",
          "rarity":"Легендарные",
          "image":"images/cart/gabriel_attal.png",
          "description":"Премьер-министр Франции с 2024 года."
        },
        {
          "name":"Михаил Мишустин",
          "title":"Председатель правительства",
          "country":"Россия",
          "rarity":"Мифические",
          "image":"images/cart/mikhail_mishustin.png",
          "description":"Председатель Правительства России с 2020 года."
        },
        {
          "name":"Дональд Трамп",
          "title":"Президент",
          "country":"США",
          "rarity":"Мифические",
          "image":"images/cart/donald_trump.png",
          "description":"45-й президент США (2017-2021)."
        },
        {
          "name":"Джей Ди Вэнс",
          "title":"Вице-президент",
          "country":"США",
          "rarity":"Мифические",
          "image":"images/cart/jd_vance.png",
          "description":"Вице-президент США."
        },
        {
          "name":"Александр Вучич",
          "title":"Президент",
          "country":"Сербия",
          "rarity":"Мифические",
          "image":"images/cart/aleksandar_vucic.png",
          "description":"Президент Сербии с 2017 года."
        },
        {
          "name":"Ана Брнабич",
          "title":"Премьер-министр",
          "country":"Сербия",
          "rarity":"Мифические",
          "image":"images/cart/ana_brnabic.png",
          "description":"Премьер-министр Сербии с 2017 года."
        },
        {
          "name":"Роман Головченко",
          "title":"Премьер-министр",
          "country":"Беларусь",
          "rarity":"Мифические",
          "image":"images/cart/roman_golovchenko.png",
          "description":"Премьер-министр Беларуси с 2020 года."
        },
        {
          "name":"Чарльз Джеймс Кирк",
          "title":"Секретный персонаж",
          "country":"США",
          "rarity":"Секретные",
          "image":"images/cart/charles_kirk.png",
          "description":"Основатель Turning Point USA."
        },
        {
          "name":"Евгений Пригожин",
          "title":"Секретный персонаж",
          "country":"Россия",
          "rarity":"Секретные",
          "image":"images/cart/evgeny_prigozhin.png",
          "description":"Основатель ЧВК 'Вагнер'."
        },
        {
          "name":"Владимир Жириновский",
          "title":"Секретный персонаж",
          "country":"Россия",
          "rarity":"Секретные",
          "image":"images/cart/vladimir_zhirinovsky.png",
          "description":"Основатель и лидер ЛДПР."
        },
        {
          "name":"Владимир Путин",
          "title":"Секретный персонаж",
          "country":"Россия",
          "rarity":"Секретные",
          "image":"images/cart/vladimir_putin.png",
          "description":"Президент России."
        },
        {
          "name":"Олаф Шольц",
          "title":"Секретный персонаж",
          "country":"Германия",
          "rarity":"Секретные",
          "image":"images/cart/olaf_scholz.png",
          "description":"Федеральный канцлер Германии (2021-2025)."
        },
        {
          "name":"Александр Лукашенко",
          "title":"Секретный персонаж",
          "country":"Беларусь",
          "rarity":"Секретные",
          "image":"images/cart/alexander_lukashenko.png",
          "description":"Президент Беларуси с 1994 года."
        },
        {
          "name":"Виктор Хренин",
          "title":"Секретный персонаж",
          "country":"Беларусь",
          "rarity":"Секретные",
          "image":"images/cart/viktor_khrenin.png",
          "description":"Министр обороны Беларуси."
        },
        {
          "name":"Анджей Дуда",
          "title":"Секретный персонаж",
          "country":"Польша",
          "rarity":"Секретные",
          "image":"images/cart/andzej_duda.png",
          "description":"Президент Польши с 2015 года."
        }
      ];

      const RARITY_CHANCES = {
        'Обычные': 50,
        'Редкие': 25,
        'Эпические': 12,
        'Легендарные': 7,
        'Мифические': 4,
        'Секретные': 2
      };

      const $ = id => document.getElementById(id);

      const flagImage = $('flagImage');
      const answersContainer = $('answersContainer');
      const restartBtn = $('restartBtn');
      const currentScoreEl = $('currentScore');
      const bestScoreEl = $('bestScore');
      const correctSound = $('correct-sound');
      const incorrectSound = $('incorrect-sound');
      const clickSound = $('click-sound');
      const bgMusic = $('bg-music');
      const settingsBtn = $('settingsBtn');
      const inventoryBtn = $('inventoryBtn');
      const inventory = $('inventory');
      const closeInventory = $('closeInventory');
      const cardsGrid = $('cardsGrid');
      const invCount = $('invCount');
      const cardModal = $('card-modal');
      const closeCardModal = $('closeCardModal');
      const cardModalContent = $('cardModalContent');

      let currentScore = 0;
      let bestScore = 0;
      let usedFlags = new Set();
      let currentFlag = null;
      let isAnswerSelected = false;
      let playerCards = [];

      function initMusic() {
        const bgMusic = $('bg-music');
        if (!bgMusic) return;
        
        try {
          const mv = localStorage.getItem('musicVol');
          bgMusic.volume = mv !== null ? Number(mv) : 0.12;
          
          document.addEventListener('click', () => {
            if (bgMusic.paused) {
              bgMusic.play().catch(() => {});
            }
          }, { once: true });
        } catch (error) {
          console.log('Ошибка инициализации музыки');
        }
      }

      function playSound(sound) {
        if (!sound || !sound.play) return;
        try {
          sound.currentTime = 0;
          sound.play().catch(() => {});
        } catch (error) {
          console.log('Ошибка воспроизведения звука');
        }
      }

      function loadScores() {
        try {
          const savedBest = localStorage.getItem('bestScore');
          bestScore = savedBest ? parseInt(savedBest) : 0;
          bestScoreEl.textContent = bestScore;
        } catch (e) {
          bestScore = 0;
        }
      }

      function saveBestScore() {
        localStorage.setItem('bestScore', bestScore.toString());
      }

      function loadPlayerCards() {
        try {
          const saved = localStorage.getItem('playerCards');
          playerCards = saved ? JSON.parse(saved) : [];
          updateInventoryCount();
        } catch (e) {
          playerCards = [];
        }
      }

      function savePlayerCards() {
        localStorage.setItem('playerCards', JSON.stringify(playerCards));
        updateInventoryCount();
      }

      function updateInventoryCount() {
        invCount.textContent = `Карт: ${playerCards.length}/${POLITICIANS.length}`;
      }

      function getRandomFlag() {
        const availableFlags = FLAGS.filter(flag => !usedFlags.has(flag.file));
        
        if (availableFlags.length === 0) {
          usedFlags.clear();
          return FLAGS[Math.floor(Math.random() * FLAGS.length)];
        }

        let pool = availableFlags;
        
        if (currentScore < 5) {
          pool = availableFlags.slice(0, 20);
        } else if (currentScore < 10) {
          pool = availableFlags.slice(0, 50);
        }

        if (pool.length === 0) {
          pool = availableFlags;
        }

        return pool[Math.floor(Math.random() * pool.length)];
      }

      function getRandomAnswers(correctCountry, count = 3) {
        const otherCountries = FLAGS
          .map(flag => flag.country)
          .filter(country => country !== correctCountry);
        
        const shuffled = otherCountries.sort(() => 0.5 - Math.random());
        return shuffled.slice(0, count);
      }

      function getRandomByWeights(weights) {
        const total = Object.values(weights).reduce((sum, weight) => sum + weight, 0);
        let random = Math.random() * total;
        for (const [item, weight] of Object.entries(weights)) {
          random -= weight;
          if (random <= 0) return item;
        }
        return Object.keys(weights)[0];
      }

      function getRandomCardByRarity(rarity) {
        const pool = POLITICIANS.filter(card => card.rarity === rarity);
        return pool.length > 0 ? {...pool[Math.floor(Math.random() * pool.length)]} : null;
      }

      function addCardToCollection(card) {
        if (!card) return false;

        const existingCard = playerCards.find(c =>
          c.name === card.name && c.country === card.country
        );

        if (!existingCard) {
          playerCards.push(card);
          savePlayerCards();
          return true;
        }
        return false;
      }

      function showNewFlag() {
        isAnswerSelected = false;
        restartBtn.classList.add('hidden');
        
        currentFlag = getRandomFlag();
        usedFlags.add(currentFlag.file);
        
        flagImage.src = `flag/${currentFlag.file}`;
        flagImage.style.animation = 'fadeIn 0.5s ease';
        
        const correctAnswer = currentFlag.country;
        const wrongAnswers = getRandomAnswers(correctAnswer, 3);
        const allAnswers = [correctAnswer, ...wrongAnswers].sort(() => 0.5 - Math.random());
        
        answersContainer.innerHTML = '';
        
        allAnswers.forEach(answer => {
          const button = document.createElement('button');
          button.className = 'answer-btn';
          button.textContent = answer;
          button.addEventListener('click', () => handleAnswer(answer === correctAnswer, button));
          answersContainer.appendChild(button);
        });
      }

      function handleAnswer(isCorrect, button) {
        if (isAnswerSelected) return;
        isAnswerSelected = true;
        
        if (isCorrect) {
          playSound(correctSound);
          button.classList.add('correct');
          currentScore++;
          currentScoreEl.textContent = currentScore;
          
          if (currentScore > bestScore) {
            bestScore = currentScore;
            bestScoreEl.textContent = bestScore;
            saveBestScore();
          }
          
          if (currentScore % 10 === 0) {
            const rarity = getRandomByWeights(RARITY_CHANCES);
            const card = getRandomCardByRarity(rarity);
            if (card) {
              const added = addCardToCollection(card);
              showCardModal(card, added);
            }
          } else {
            setTimeout(showNewFlag, 1000);
          }
        } else {
          playSound(incorrectSound);
          button.classList.add('incorrect');
          
          const correctButton = Array.from(answersContainer.children).find(
            btn => btn.textContent === currentFlag.country
          );
          if (correctButton) {
            correctButton.classList.add('correct');
          }
          
          restartBtn.classList.remove('hidden');
        }
      }

      function showCardModal(card, isNew) {
        cardModalContent.innerHTML = `
          <h2 style="margin-bottom: 20px; color: var(--text-primary);">${isNew ? 'НОВАЯ КАРТА!' : 'ПОВТОРКА'}</h2>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; align-items: start;">
            <div>
              <img src="${card.image}" alt="${card.name}" style="width: 100%; border-radius: var(--radius-md);">
            </div>
            <div>
              <h3 style="font-size: 20px; margin-bottom: 8px;">${card.name}</h3>
              <p style="color: var(--text-secondary); margin-bottom: 8px;">${card.title}</p>
              <p style="color: var(--text-secondary); margin-bottom: 12px;">${card.country}</p>
              <div class="rarity-badge" style="background: ${getRarityColor(card.rarity)}; color: #000; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: bold;">
                ${card.rarity}
              </div>
              <p style="margin-top: 12px; color: var(--text-secondary); font-size: 14px;">${card.description}</p>
            </div>
          </div>
        `;
        cardModal.classList.remove('hidden');
      }

      function getRarityColor(rarity) {
        const colors = {
          'Обычные': '#84c78a',
          'Редкие': '#84b8ff',
          'Эпические': '#c89cff',
          'Легендарные': '#ffd37a',
          'Мифические': '#ff7a7a',
          'Секретные': '#9ea0a6'
        };
        return colors[rarity] || '#9ea0a6';
      }

      function restartGame() {
        currentScore = 0;
        currentScoreEl.textContent = '0';
        usedFlags.clear();
        showNewFlag();
      }

      function openInventory() {
        playSound(clickSound);
        renderInventory();
        inventory.classList.remove('hidden');
      }

      function closeInventoryModal() {
        playSound(clickSound);
        inventory.classList.add('hidden');
      }

      function closeCardModalFunc() {
        playSound(clickSound);
        cardModal.classList.add('hidden');
        showNewFlag();
      }

      function renderInventory() {
        cardsGrid.innerHTML = '';
        
        playerCards.forEach(card => {
          const cardElement = document.createElement('div');
          cardElement.className = 'card';
          cardElement.innerHTML = `
            <img src="${card.image}" alt="${card.name}" onerror="this.src='images/foto.png'">
            <div class="card-name">${card.name}</div>
            <div class="card-meta">${card.title}<br>${card.country}</div>
            <div class="rarity-strip rarity-${card.rarity}"></div>
          `;
          cardElement.addEventListener('click', () => showCardDetails(card));
          cardsGrid.appendChild(cardElement);
        });

        updateInventoryCount();
      }

      function showCardDetails(card) {
        cardModalContent.innerHTML = `
          <h2 style="margin-bottom: 20px; color: var(--text-primary);">${card.name}</h2>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; align-items: start;">
            <div>
              <img src="${card.image}" alt="${card.name}" style="width: 100%; border-radius: var(--radius-md);">
            </div>
            <div>
              <h3 style="font-size: 18px; margin-bottom: 8px;">${card.title}</h3>
              <p style="color: var(--text-secondary); margin-bottom: 12px;">${card.country}</p>
              <div class="rarity-badge" style="background: ${getRarityColor(card.rarity)}; color: #000; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: bold;">
                ${card.rarity}
              </div>
              <p style="margin-top: 12px; color: var(--text-secondary); font-size: 14px;">${card.description}</p>
            </div>
          </div>
        `;
        cardModal.classList.remove('hidden');
      }

      function openSettings() {
        const existing = document.getElementById('settings-panel');
        if (existing) {
          existing.classList.toggle('hidden');
          return;
        }

        const panel = document.createElement('div');
        panel.id = 'settings-panel';
        panel.style.cssText = `
          position: fixed;
          right: 20px;
          top: 80px;
          width: 320px;
          z-index: 9999;
          border-radius: 12px;
          background: var(--bg-card);
          padding: 20px;
          box-shadow: var(--shadow-dark);
          border: 1px solid var(--border-color);
          color: var(--text-primary);
        `;

        panel.innerHTML = `
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <strong>Настройки</strong>
            <button id="closeSettings" class="close-btn">✕</button>
          </div>
          <div style="display: flex; flex-direction: column; gap: 16px;">
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 600;">Громкость музыки</label>
              <input id="musicRange" type="range" min="0" max="1" step="0.01" value="${bgMusic ? bgMusic.volume : 0.12}"
                     style="width: 100%;">
            </div>
            <div>
              <label style="display: block; margin-bottom: 8px; font-weight: 600;">Громкость эффектов</label>
              <input id="sfxRange" type="range" min="0" max="1" step="0.01" value="${correctSound ? correctSound.volume : 1}"
                     style="width: 100%;">
            </div>
            <button id="resetProgress" style="padding: 12px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: var(--radius-md); color: var(--text-primary); cursor: pointer;">Сбросить прогресс</button>
          </div>
        `;

        document.body.appendChild(panel);

        document.getElementById('closeSettings').addEventListener('click', () => {
          playSound(clickSound);
          panel.remove();
        });

        const musicRange = document.getElementById('musicRange');
        const sfxRange = document.getElementById('sfxRange');
        const resetProgress = document.getElementById('resetProgress');

        musicRange.addEventListener('input', (e) => {
          bgMusic.volume = Number(e.target.value);
          localStorage.setItem('musicVol', String(bgMusic.volume));
        });

        sfxRange.addEventListener('input', (e) => {
          const v = Number(e.target.value);
          correctSound.volume = v;
          incorrectSound.volume = v;
          clickSound.volume = v;
          localStorage.setItem('sfxVol', String(v));
        });

        resetProgress.addEventListener('click', () => {
          playSound(clickSound);
          if (confirm('Вы уверены, что хотите сбросить весь прогресс? Все карты и рекорд будут удалены.')) {
            localStorage.removeItem('bestScore');
            localStorage.removeItem('playerCards');
            bestScore = 0;
            bestScoreEl.textContent = '0';
            currentScore = 0;
            currentScoreEl.textContent = '0';
            playerCards = [];
            panel.remove();
            restartGame();
          }
        });
      }

      function init() {
        loadScores();
        loadPlayerCards();
        initMusic();

        const clickSound = $('click-sound');
        if (clickSound) {
          const sv = localStorage.getItem('sfxVol');
          if (sv !== null) {
            clickSound.volume = Number(sv);
          }
        }

        if (restartBtn) {
          restartBtn.addEventListener('click', restartGame);
        }

        if (settingsBtn) {
          settingsBtn.addEventListener('click', openSettings);
        }

        if (inventoryBtn) {
          inventoryBtn.addEventListener('click', openInventory);
        }

        if (closeInventory) {
          closeInventory.addEventListener('click', closeInventoryModal);
        }

        if (closeCardModal) {
          closeCardModal.addEventListener('click', closeCardModalFunc);
        }

        showNewFlag();
      }

      document.addEventListener('DOMContentLoaded', init);
    })();
  </script>
</body>
</html>